# Releasing on GitHub

## Using [release-github.yml](../.github/workflows/release-github.yml) in callers

Several permissions are included in this workflow:
- `pull-requests: read`
- `contents: write`

They're invoked at the workflow level for the `release` job. Writing contents ensures that the workflow can create new assets for the release. Reading the PR is required by `inputs.get_sbom`, in that the endpoint to GET artifacts from the pull requests means that the SBOM can be retrieved and then uploaded as a release asset.


### Explicit permissions with defaults

A minimal workflow will create a release on GitHub with tags for the given version and separately for `latest`.

```yaml
jobs:
  release-github:
    uses: digicatapult/shared-workflows/.github/workflows/release-github.yml@main
    permissions:
      pull-requests: read
      contents: write
```


### Implicit permissions

```yaml
jobs:
  release-github:
    uses: digicatapult/shared-workflows/.github/workflows/release-github.yml@main
```


### Minimal with dependencies

This kind of job in `release.yml` should be dependent on a build step succeededing, e.g. [build-docker.yml](../.github/workflows/build-docker.yml) via `needs: [build-docker]`, to help avoid broken releases.

```yaml
jobs:
  release-github:
    uses: digicatapult/shared-workflows/.github/workflows/release-github.yml@main
    needs: [build-docker]
    permissions:
      pull-requests: read
      contents: write
```


### Minimal with attestable SBOM assets

To release the SBOM generated by Docker Scout as an asset, `inputs.get_sbom` must be set to `true`. One of Scout's features is its ability to create cryptographic assertions for the SBOMs it generates. These can then be used to attest the provenance of that file against its accompanying Docker image.

```yaml
jobs:
  release-github:
    uses: digicatapult/shared-workflows/.github/workflows/release-github.yml@main
    needs: [build-docker]
    permissions:
      pull-requests: read
      contents: write
    with:
      get_sboms: true
```
