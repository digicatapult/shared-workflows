# Releasing on GitHub

## Using [release-github.yml](../.github/workflows/release-github.yml) in callers

Several permissions are included in this workflow:
- `pull-requests: read`
- `contents: write`

They're invoked at the workflow level for the `release` job.

> [!TIP]
> Permission blocks in the caller workflow can be omitted and made implicit, to reduce maintenance when making changes to the callee. They can also be explicit, to minimise warnings from CodeQL scans and to enforce compliance. Any divergence in the permissions invoked can result in a workflow breaking, specifically where the caller assumes permissions that the callee isn't expecting. It's a trade-off between DRY principles, convenience, and compliance.


### Implicit permissions with defaults

A minimal workflow will create a release on GitHub with tags for the given version and separately for `latest`.

```yaml
jobs:
  release-github:
    uses: digicatapult/shared-workflows/.github/workflows/release-github.yml@main
```


### Explicit permissions

```yaml
jobs:
  release-github:
    uses: digicatapult/shared-workflows/.github/workflows/release-github.yml@main
    permissions:
      pull-requests: read
      contents: write
```


### Minimal with dependencies

In practice, this kind of job should be dependent on a build step succeededing, e.g. [build-docker.yml](../.github/workflows/build-docker.yml) via `needs: [build-docker]`, to help avoid broken releases.


```yaml
jobs:
  release-github:
    needs: [build-docker]
    uses: digicatapult/shared-workflows/.github/workflows/release-github.yml@main
```


### Minimal with attestable SBOM assets

To release the SBOM generated by Docker Scout as an asset, `inputs.get_sbom` must be set to `true`. One of Scout's features is its ability to create cryptographic assertions for the SBOMs it generates. These can then be used to attest the provenance of that file against its accompanying Docker image.

```yaml
jobs:
  release-github:
    uses: digicatapult/shared-workflows/.github/workflows/release-github.yml@main
    needs: [build-docker]
    with:
      get_sboms: true
```
